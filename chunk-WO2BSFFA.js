import{i as f}from"./chunk-WRX7OGXN.js";import{$ as y,a as s,b as c,ea as I,k as m}from"./chunk-PQBPDIQK.js";var b=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),a={randomUUID:b};var o,x=new Uint8Array(16);function l(){if(!o&&(o=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(x)}var d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));function h(e,t=0){return d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]}function w(e,t,n){if(a.randomUUID&&!t&&!e)return a.randomUUID();e=e||{};let i=e.random||(e.rng||l)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=i[r];return t}return h(i)}var u=w;var v=class e{constructor(t){this.storageService=t;this.loadIdentities()}storageKey="identity-workbench-identities";identitiesSubject=new m([]);identities$=this.identitiesSubject.asObservable();loadIdentities(){let t=this.storageService.get(this.storageKey)||[];this.identitiesSubject.next(t)}saveIdentities(t){this.storageService.set(this.storageKey,t),this.identitiesSubject.next(t)}getAllIdentities(){return this.identities$}getIdentityById(t){return this.identitiesSubject.value.find(i=>i.id===t)}addIdentity(t){let n=new Date,i={id:t.id||`did:key:${u()}`,method:t.method||"key",publicKey:t.publicKey||"",privateKey:t.privateKey,name:t.name||`Identity ${this.identitiesSubject.value.length+1}`,description:t.description,created:n,updated:n,didDocument:t.didDocument},r=[...this.identitiesSubject.value,i];return this.saveIdentities(r),i}updateIdentity(t,n){let i=this.identitiesSubject.value,r=i.findIndex(S=>S.id===t);if(r===-1)throw new Error(`Identity with id ${t} not found`);let p=c(s(s({},i[r]),n),{updated:new Date}),g=[...i.slice(0,r),p,...i.slice(r+1)];return this.saveIdentities(g),p}deleteIdentity(t){let i=this.identitiesSubject.value.filter(r=>r.id!==t);this.saveIdentities(i)}importFromDIDString(t){if(!t.startsWith("did:"))return null;let n=t.split(":");if(n.length<3)return null;let i=n[1];return this.addIdentity({id:t,method:i,publicKey:n.slice(2).join(":"),name:`Imported ${i.toUpperCase()} DID`,description:`Imported on ${new Date().toLocaleString()}`})}importFromStellarKey(t){if(!t||t.length<16)return null;let n=`did:stellar:${t}`;return this.addIdentity({id:n,method:"stellar",publicKey:t,name:"Imported Stellar Key",description:`Imported on ${new Date().toLocaleString()}`})}importFromJsonFile(t){if(!t||!t.id||!t.id.startsWith("did:"))return null;let n=t.id.split(":");if(n.length<3)return null;let i="";if(t.verificationMethod&&t.verificationMethod.length>0){for(let r of t.verificationMethod)if((r.type==="Ed25519VerificationKey2018"||r.type==="Ed25519VerificationKey2020")&&r.publicKeyBase58){i=r.publicKeyBase58;break}}return this.addIdentity({id:t.id,method:n[1],publicKey:i,name:`Imported ${n[1].toUpperCase()} DID Document`,description:`Imported on ${new Date().toLocaleString()}`,didDocument:t})}static \u0275fac=function(n){return new(n||e)(I(f))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};export{u as a,v as b};
